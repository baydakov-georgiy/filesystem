TEST_F(FileSystemTest, ChangeDirectoryParent) {
    testing::internal::CaptureStdout();
    fs->mkdir("dir1");
    fs->changeDirectory("dir1");
    EXPECT_TRUE(fs->changeDirectory(".."));
    testing::internal::GetCapturedStdout();
    EXPECT_EQ(fs->getCurrentPath(), "/");
}

TEST_F(FileSystemTest, WriteFile) {
    testing::internal::CaptureStdout();
    fs->touch("test.txt");
    EXPECT_TRUE(fs->writeFile("test.txt", "Hello World"));
    testing::internal::GetCapturedStdout();
}

TEST_F(FileSystemTest, AppendFile) {
    testing::internal::CaptureStdout();
    fs->touch("test.txt");
    fs->writeFile("test.txt", "Hello");
    EXPECT_TRUE(fs->appendFile("test.txt", " World"));
    testing::internal::GetCapturedStdout();
}

TEST_F(FileSystemTest, ReadFile) {
    testing::internal::CaptureStdout();
    fs->touch("test.txt");
    fs->writeFile("test.txt", "Test Content");
    testing::internal::GetCapturedStdout();
    EXPECT_EQ(fs->readFile("test.txt"), "Test Content");
}

TEST_F(FileSystemTest, FindInFile) {
    testing::internal::CaptureStdout();
    fs->touch("test.txt");
    fs->writeFile("test.txt", "Hello World");
    testing::internal::GetCapturedStdout();
    EXPECT_EQ(fs->findInFile("test.txt", "World"), 6);
    EXPECT_EQ(fs->findInFile("test.txt", "NotFound"), -1);
}

TEST_F(FileSystemTest, InsertInFile) {
    testing::internal::CaptureStdout();
    fs->touch("test.txt");
    fs->writeFile("test.txt", "Hello World");
    EXPECT_TRUE(fs->insertInFile("test.txt", 5, " Beautiful"));
    testing::internal::GetCapturedStdout();
    EXPECT_EQ(fs->readFile("test.txt"), "Hello Beautiful World");
}

TEST_F(FileSystemTest, DeleteFromFile) {
    testing::internal::CaptureStdout();
    fs->touch("test.txt");
    fs->writeFile("test.txt", "Hello Beautiful World");
    EXPECT_TRUE(fs->deleteFromFile("test.txt", " Beautiful"));
    testing::internal::GetCapturedStdout();
    EXPECT_EQ(fs->readFile("test.txt"), "Hello World");
}

TEST_F(FileSystemTest, RemoveFile) {
    testing::internal::CaptureStdout();
    fs->touch("test.txt");
    EXPECT_TRUE(fs->rm("test.txt"));
    testing::internal::GetCapturedStdout();
}

TEST_F(FileSystemTest, RemoveDirectory) {
    testing::internal::CaptureStdout();
    fs->mkdir("testdir");
    EXPECT_TRUE(fs->rm("testdir", true));
    testing::internal::GetCapturedStdout();
}

TEST_F(FileSystemTest, ChmodFile) {
    testing::internal::CaptureStdout();
    fs->touch("test.txt");
    EXPECT_TRUE(fs->chmod("644", "test.txt"));
    testing::internal::GetCapturedStdout();
}

TEST_F(FileSystemTest, PermissionCheck) {
    testing::internal::CaptureStdout();
    fs->touch("test.txt");
    fs->chmod("000", "test.txt");
    EXPECT_FALSE(fs->writeFile("test.txt", "test"));
    testing::internal::GetCapturedStdout();
}

TEST_F(FileSystemTest, AbsolutePath) {
    testing::internal::CaptureStdout();
    fs->mkdir("dir1");
    fs->mkdir("dir1/dir2");
    EXPECT_TRUE(fs->changeDirectory("/dir1/dir2"));
    testing::internal::GetCapturedStdout();
    EXPECT_EQ(fs->getCurrentPath(), "/dir1/dir2");
}

TEST_F(FileSystemTest, RelativePath) {
    testing::internal::CaptureStdout();
    fs->mkdir("dir1");
    fs->changeDirectory("dir1");
    fs->mkdir("dir2");
    EXPECT_TRUE(fs->changeDirectory("dir2"));
    testing::internal::GetCapturedStdout();
    EXPECT_EQ(fs->getCurrentPath(), "/dir1/dir2");
}

TEST_F(FileSystemTest, CreateNestedDirectories) {
    testing::internal::CaptureStdout();
    EXPECT_TRUE(fs->createDirectory("/a/b/c", true));
    EXPECT_TRUE(fs->changeDirectory("/a/b/c"));
    testing::internal::GetCapturedStdout();
    EXPECT_EQ(fs->getCurrentPath(), "/a/b/c");
}

TEST_F(FileSystemTest, CreateFileInDirectory) {
    testing::internal::CaptureStdout();
    fs->mkdir("testdir");
    fs->changeDirectory("testdir");
    EXPECT_TRUE(fs->touch("file.txt"));
    testing::internal::GetCapturedStdout();
}

TEST_F(FileSystemTest, LargeFileOperations) {
    testing::internal::CaptureStdout();
    fs->touch("large.txt");
    std::string large(10000, 'X');
    fs->writeFile("large.txt", large);
    testing::internal::GetCapturedStdout();
    EXPECT_EQ(fs->readFile("large.txt").length(), 10000);
}

TEST_F(FileSystemTest, MultipleFilesInDirectory) {
    testing::internal::CaptureStdout();
    fs->mkdir("testdir");
    fs->changeDirectory("testdir");
    for (int i = 0; i < 100; i++) {
        fs->touch("file" + std::to_string(i) + ".txt");
    }
    testing::internal::GetCapturedStdout();
}

TEST_F(FileSystemTest, DebugMode) {
    EXPECT_FALSE(fs->isDebugMode());
    testing::internal::CaptureStdout();
    fs->toggleDebug();
    testing::internal::GetCapturedStdout();
    EXPECT_TRUE(fs->isDebugMode());
}

TEST_F(FileSystemTest, FileNotFound) {
    EXPECT_EQ(fs->readFile("notfound.txt"), "");
}

TEST_F(FileSystemTest, DirectoryNotFound) {
    testing::internal::CaptureStdout();
    EXPECT_FALSE(fs->changeDirectory("notfound"));
    testing::internal::GetCapturedStdout();
}

TEST_F(FileSystemTest, RemoveNonEmptyDirectoryWithoutRecursive) {
    testing::internal::CaptureStdout();
    fs->mkdir("dir1");
    fs->touch("dir1/file.txt");
    EXPECT_FALSE(fs->rm("dir1", false));
    testing::internal::GetCapturedStdout();
}
